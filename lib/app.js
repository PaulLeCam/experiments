// Generated by CoffeeScript 1.4.0
var RedisStore, app, auth, config, debug, express, port, redis, _ref;

config = require("../config").app;

express = require("express");

RedisStore = require("connect-redis")(express);

debug = require("debug")("app");

redis = require("./components/database/redis");

auth = require("./components/security/auth");

app = express();

app.engine("jade", require("jade").__express);

app.configure(function() {
  this.set("view engine", "jade");
  this.set("views", "" + __dirname + "/../lib/views");
  this.use(express.logger("dev"));
  this.use(express.compress());
  this.use(express.favicon());
  this.use(express["static"]("" + __dirname + "/../www"));
  this.use(express.cookieParser("SGSDGHE4Z92364234YE7857354"));
  this.use(express.session({
    store: new RedisStore({
      client: redis.client,
      prefix: redis.prefix("sess:"),
      ttl: 3600
    }),
    secret: "TDIUREQT496457036TQZRGQ"
  }));
  this.use(express.bodyParser());
  this.use(express.csrf());
  this.use(auth.middleware());
  this.use(require("./routes"));
  return this.use(express.errorHandler());
});

port = (_ref = config.port) != null ? _ref : 3000;

app.listen(port);

debug("listening on port %s", port);
